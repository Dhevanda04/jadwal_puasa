<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadwal Puasa PRO+</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
    font-family:Arial, sans-serif;
    background:linear-gradient(135deg,#1e3c72,#2a5298);
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    margin:0;
    color:white;
}
.container{
    background:rgba(255,255,255,0.1);
    padding:25px;
    border-radius:15px;
    width:420px;
}
input,select{
    padding:6px;
    border-radius:6px;
    border:none;
    margin:5px 0;
}
button{
    padding:8px 12px;
    margin:5px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.hijau{background:#2ecc71;color:white;}
.merah{background:#e74c3c;color:white;}
.biru{background:#3498db;color:white;}
.orange{background:#f39c12;color:white;}
.daftar{
    margin-top:10px;
    max-height:200px;
    overflow:auto;
    background:rgba(0,0,0,0.2);
    padding:10px;
    border-radius:8px;
}
canvas{
    background:white;
    border-radius:8px;
    margin-top:10px;
}
</style>
</head>
<body>

<div class="container">
<h2>Jadwal Puasa PRO+</h2>

<input type="text" id="nama" placeholder="Masukkan Nama">

<div id="today"></div>

<button onclick="setStatus('puasa')" class="hijau">Puasa</button>
<button onclick="setStatus('tidak')" class="merah">Tidak</button>

<h3 id="status"></h3>

<hr>

<label>Filter Bulan:</label>
<select id="filterBulan" onchange="render()">
<option value="">Semua</option>
</select>

<h4>Total Puasa: <span id="totalPuasa">0</span></h4>

<div class="daftar">
<strong>Riwayat:</strong>
<div id="list"></div>
</div>

<canvas id="chart" width="350" height="150"></canvas>

<button onclick="downloadPDF()" class="biru">Download PDF</button>
<button onclick="hapusData()" class="orange">Hapus Semua</button>

</div>

<script>
const { jsPDF } = window.jspdf;

const today = new Date();
const isoDate = today.toISOString().split("T")[0];

document.getElementById("today").textContent =
today.toLocaleDateString("id-ID",{
weekday:"long",year:"numeric",month:"long",day:"numeric"
});

function getData(){
return JSON.parse(localStorage.getItem("puasaData"))||{};
}
function saveData(d){
localStorage.setItem("puasaData",JSON.stringify(d));
}
function setStatus(val){
const d=getData();
d[isoDate]=val;
saveData(d);
render();
}
function hapusData(){
if(confirm("Hapus semua data?")){
localStorage.removeItem("puasaData");
render();
}
}

function render(){
const data=getData();
const list=document.getElementById("list");
const totalEl=document.getElementById("totalPuasa");
const statusEl=document.getElementById("status");
const filter=document.getElementById("filterBulan").value;

list.innerHTML="";
let total=0;

Object.keys(data).sort().reverse().forEach(date=>{
const d=new Date(date);
const bulan=d.getMonth()+1;
if(filter && bulan!=filter) return;

const div=document.createElement("div");
div.textContent=
d.toLocaleDateString("id-ID")+" - "+
(data[date]==="puasa"?"Puasa":"Tidak");

if(data[date]==="puasa") total++;
list.appendChild(div);
});

totalEl.textContent=total;

statusEl.textContent=
data[isoDate]==="puasa"?"Hari ini Puasa":
data[isoDate]==="tidak"?"Hari ini Tidak Puasa":
"Belum memilih hari ini";

drawChart(total,Object.keys(data).length-total);
}

function isiFilter(){
for(let i=1;i<=12;i++){
const o=document.createElement("option");
o.value=i;
o.textContent=i;
document.getElementById("filterBulan").appendChild(o);
}
}

function drawChart(puasa,tidak){
const c=document.getElementById("chart");
const ctx=c.getContext("2d");
ctx.clearRect(0,0,c.width,c.height);

ctx.fillStyle="#2ecc71";
ctx.fillRect(50,150-puasa*10,50,puasa*10);
ctx.fillStyle="#e74c3c";
ctx.fillRect(150,150-tidak*10,50,tidak*10);

ctx.fillStyle="black";
ctx.fillText("Puasa",50,145);
ctx.fillText("Tidak",150,145);
}

function downloadPDF(){
const doc=new jsPDF();
const data=getData();
const nama=document.getElementById("nama").value||"Tanpa Nama";

doc.setFontSize(16);
doc.text("LAPORAN JADWAL PUASA",20,20);
doc.setFontSize(12);
doc.text("Nama: "+nama,20,30);

let y=40;
let total=0;

Object.keys(data).sort().forEach(date=>{
const status=data[date]==="puasa"?"Puasa":"Tidak";
doc.text(
new Date(date).toLocaleDateString("id-ID")+" - "+status,
20,y
);
if(status==="Puasa") total++;
y+=8;
});

doc.text("Total Puasa: "+total+" hari",20,y+10);

doc.save("laporan-puasa.pdf");
}

isiFilter();
render();
</script>

</body>
</html>